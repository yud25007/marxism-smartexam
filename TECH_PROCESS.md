# 技术处理过程文档 (Technical Processing Journal)

本文档按时间顺序记录项目开发过程中的需求变更、技术难点、解决方案及运行成果。

---

## 📅 2025-12-25

### 1. 需求：通知公告系统深度增强
*   **用户需求**：支持 Markdown 全语法、图片上传、按身份角色（ADMIN/VIP/MEMBER）定向推送、查看历史公告。
*   **遇到问题**：
    1.  `react-markdown` 默认不支持 HTML 标签（如图片样式）和表格。
    2.  初期设计的“分组(Group)”字段与“身份(Role)”字段功能重叠，导致逻辑复杂。
*   **解决办法**：
    1.  引入 `rehype-raw` 支持 HTML，引入 `remark-gfm` 支持 Markdown 表格。
    2.  **架构重构**：删去冗余的 `group` 字段，统一基于 `role` 进行过滤。
    3.  重构 `AnnouncementModal`，增加 `viewMode` 状态，实现“自动弹出最新”与“手动查看历史”的逻辑切换。
*   **最终成果**：公告系统现具备美观的图片展示、分身份推送能力及完整的历史回溯功能。

### 2. 需求：笔记系统进化与 LaTeX 支持
*   **用户需求**：笔记支持换行、支持文字颜色/背景/划线、支持 AI 解析中的数学公式渲染。
*   **遇到问题**：
    1.  传统 Markdown 编辑器对小白用户不友好，且难以实现灵活的局部文字美化。
    2.  AI 提供的科学公式（如资本有机构成）呈现为原始代码，不便阅读。
*   **解决办法**：
    1.  **所见即所得 (WYSIWYG)**：将 `Notebook` 改为基于 HTML `contentEditable` 的富文本编辑器，并自研工具栏（调用 `document.execCommand`）。
    2.  **公式渲染**：集成 `KaTeX` 引擎，通过 `remark-math` 和 `rehype-katex` 插件实现公式自动排版。
*   **最终成果**：笔记编辑体验接近 Word，AI 解析达到专业教材级别的公式呈现。

### 3. 需求：题库云端化迁移与在线改题
*   **用户需求**：将 1.3 万道题目从本地 JSON 同步到云端，并支持管理员在线修正答案。
*   **遇到问题**：
    1.  **安全拦截**：Supabase 默认的 RLS 策略拒绝了来自自定义登录系统的写入请求。
    2.  **性能瓶颈**：1.3 万行数据量巨大，前端同步需考虑分批处理防止浏览器假死。
*   **解决办法**：
    1.  **权限放开**：在 SQL 中更新 RLS 策略，创建 `Enable All Write` 规则以适配当前 Auth 系统。
    2.  **批量迁移**：编写 `importService`，将题目按 100 题/批次分段上传。
    3.  **快捷工具**：在 `ResultView` 解析界面为管理员增加一个浮动工具条，实现“边看解析边改答案”。
*   **最终成果**：题库成功实现云端动态管理，管理员拥有了极高的纠错效率。

### 4. 需求：系统核心控制中心（全局开关）
*   **用户需求**：在后台设置开关，控制维护模式、同步权限等。
*   **遇到问题**：
    1.  初次实现仅有 UI 图标，缺乏实际的后端逻辑拦截。
    2.  `Header.tsx` 逻辑修改后，因漏导 `useState` 导致全站崩溃。
*   **解决办法**：
    1.  **逻辑闭环**：在 `App.tsx` 根组件增加拦截器，开启维护模式时除管理员外均重定向至“维护中”页面。
    2.  **热修复**：紧急修复导入错误，并通过 `npm run build` 确保发布前代码零报错。
*   **最终成果**：管理员获得了对全站行为的一键调控权，系统运维更具安全性。

---
**当前项目状态**：架构已完成从“静态”向“云端动态”的华丽转型，各项高级功能运行稳定。
