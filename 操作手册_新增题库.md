# 马原在线答题系统：新增题库与权限控制操作手册

本手册旨在指导如何将外部 JSON 题库导入系统，生成独立的展示模块，并实现针对普通用户的角色锁定功能。

## 一、 环境准备
*   **源代码库**：`marxism-smartexam`
*   **新增题库文件**：`questions.json` (UTF-8 编码)
*   **工具**：VS Code 或其他代码编辑器，Git 命令行工具

---

## 二、 第一阶段：数据预处理 (创建 TS 数据文件)

由于题库量通常较大，直接修改核心配置文件会导致卡顿。推荐创建一个独立的数据文件进行引用。

1.  **创建文件**：在项目根目录下新建 `extra_data.ts`。
2.  **转换格式**：将您的 JSON 数据封装进 `EXTRA_CHAPTER` 常量中。
    *   **ID 分配**：请确保 `id` 与现有章节不重复（例如设置为 `8`）。
    *   **题型分类**：
        *   `single_choice`：`answer` 数组长度为 1 的题目。
        *   `multiple_choice`：`answer` 数组长度大于 1 的题目。
3.  **代码示例**：
    ```typescript
    // extra_data.ts
    export const EXTRA_CHAPTER = {
      "id": 8,
      "name": "新增综合题库",
      "single_choice": [
        { "id": 1, "question": "示例问题", "options": {"A":"选项1","B":"选项2"}, "answer": "A" }
      ],
      "multiple_choice": [
        { "id": 101, "question": "示例多选", "options": {"A":"选项1","B":"选项2"}, "answer": ["A","B"] }
      ],
      "true_false": [] 
    };
    ```

---

## 三、 第二阶段：项目整合 (挂载新章节)

修改系统的核心常量文件，让新题库在首页生效。

1.  **打开文件**：`constants.ts`
2.  **导入数据**：在文件顶部添加导入：
    ```typescript
    import { EXTRA_CHAPTER } from './extra_data';
    ```
3.  **加入章节列表**：找到 `const RAW_DATA = { ... "chapters": [ ... ] }`，在数组的最后一位添加 `EXTRA_CHAPTER`。
    ```typescript
    const RAW_DATA = {
      // ... 
      "chapters": [
        // ... 原有章节
        EXTRA_CHAPTER
      ]
    };
    ```

---

## 四、 第三阶段：权限控制 (对普通用户锁定)

为了实现“管理员可练，普通用户锁定”的效果，需要修改 `App.tsx` 的前端逻辑。

1.  **首页视觉锁定**：
    找到 `EXAMS.map` 循环渲染的地方，修改 `isLocked` 属性：
    ```tsx
    {EXAMS.map(exam => {
      // 逻辑：如果是第8章且用户不是ADMIN，则视为锁定
      const isChapter8Locked = exam.id === 'chapter_8' && currentUser?.role !== 'ADMIN';
      return (
        <ExamCard 
          key={exam.id} 
          exam={exam} 
          onStart={handleStartExam}
          isLocked={!currentUser || isChapter8Locked} // 满足任意条件即锁定
        />
      );
    })}
    ```

2.  **点击行为拦截**：
    在 `handleStartExam` 函数中添加权限判断：
    ```typescript
    const handleStartExam = (exam: Exam) => {
      // 1. 基础登录检查
      if (!currentUser) { setView('LOGIN'); return; }

      // 2. 新增：针对特定章节的管理员拦截
      if (exam.id === 'chapter_8' && currentUser.role !== 'ADMIN') {
        alert('该题库目前仅限管理员访问练习。');
        return;
      }

      setActiveExam(exam);
      setView('EXAM');
    };
    ```

---

## 五、 第四阶段：发布更新 (Git 提交)

执行以下命令将更改同步到 GitHub 仓库：

```bash
# 1. 暂存所有更改（包含新增的 extra_data.ts）
git add .

# 2. 提交更改描述
git commit -m "feat: 导入1000道新增题库并限制普通用户访问"

# 3. 推送到远程分支
git push origin master
```

---

## 六、 常见问题排查 (Tips)
*   **乱码问题**：如果页面显示乱码，请确认 `extra_data.ts` 的保存编码必须是 **UTF-8**。
*   **ID 对应**：在数据文件中 `id` 是 `8`，但在逻辑代码中判断时，框架会自动加上前缀，变成 `'chapter_8'`。
*   **角色说明**：系统中 `ADMIN` 代表管理员，`MEMBER` 代表普通注册用户。

---
**文档版本**：2025-12-24 
**状态**：已成功导出
